# Maleware Detection using Opcode Sequence

## Todo List

- [ ] CNN 모델링 -> CNN vs DNN 결정
- [ ] feature vector length에 따른 정확도 확인
  - -> 가능하면 CNN, DNN 각각에 대한 정확도 변화율 확인
- [ ] v-gram 사용 시 정확도 확인
  - -> 사실상 불가능 할 것 같다.

---

#### Summary

[V-그램: 명령어 기본 블록과 딥러닝 기반의 악성코드 탐지](#reference) 논문 리뷰 및 구현

#### Member

| 구분   | 이름   | 소속                            | 이메일                  |
| ------ | ------ | ------------------------------- | ----------------------- |
| 팀원 1 | 김선웅 | 한양대학교 컴퓨터소프트웨어학부 | sunung007@hanyang.ac.kr |
| 팀원 2 | 김성애 | 한양대학교 컴퓨터소프트웨어학부 |                         |

---

## Contents

- [Usage](#usage)
- [Implements](#implements)
- [Result](#result)
- [Reference](#reference)

---

## Usage

1. 필요한 라이브러리 설치

   - 명령어 : `pip install -r requirements.txt`

<!-- 2. ~~데이터 다운로드(테스트 중에는 생략)~~
   - 명령어 : `python3 src/util/download_dataset.py` -->

2. 코드 실행
   - 파일명 : `src/main.ipynb`
   - 실행 순서 : '파일 읽기' 전까지의 블락 -> 'Classifier' 이후의 블락
   - 주의 : Classifier 이후의 블락 중 `fdataset = pd.read_csv(f"{MAIN_DIR}/data/traindata_only_fvector_size={FEATURE_VECTOR_LEN}.csv", header=0)` 코드가 주석처리 되어있을 경우 해제해야 한다.

---

## Implements

#### Environment

| 구분            | 내용                                            |
| --------------- | ----------------------------------------------- |
| OS              | Ubuntu 20.04.4 LTS                              |
| CPU             | 11th Gen Intel(R) Core(TM) i9-11900KF @ 3.50GHz |
| GPU             | NVIDIA Corporation Device 2204 (rev a1)         |
| Python          | 3.8.10                                          |
| Major Libraries |                                                 |

#### Summary

....

### Using DNN

K-fold를 이용하여 훈련

---

## Experiment

### Outlier 처리/미처리 (in DNN)

Outlier의 처리 조건은 다음과 같다.

- Basic block 내의 opcode의 수가 n개 이하인 block은 버린다.
- File 내의 basic block 수가 m개 이하인 block은 버린다.

| 구분           | Loss       | Accuracy     | 비고            |
| -------------- | ---------- | ------------ | --------------- |
| Outlier 미처리 | 3.53744268 | 56.67475462% |                 |
| Outlier 처리   | 1.71627963 | 80.37865758% | n = 10, m = 100 |

> Outlier 미처리 시 결과 (좌 : loss 변화 / 우 : accuracy 변화)

<img src="img/result_dnn_not_process_outlier.png"/>

> Outlier 처리 시 결과 (좌 : loss 변화 / 우 : accuracy 변화)

<img src="img/result_dnn_process_outlier(n=10, m=100).png"/>

### Feature Vector 길이에 따른 변화 (DNN vs CNN)

| Model | Type     | 16     | 32     | 64     | 128    | 256    | 512    | 1024   | 2048   |
| ----- | -------- | ------ | ------ | ------ | ------ | ------ | ------ | ------ | ------ |
| DNN   | Loss     | 4.7389 | 2.3555 | 2.4262 | 1.4971 | 1.3815 | 3.8385 | 3.9825 | 3.2606 |
|       | Accuracy | 0.7969 | 0.8193 | 0.8176 | 0.8227 | 0.8520 | 0.8262 | 0.8176 | 0.8606 |

> DNN의 변화 : 정확도는 2048 -> 256 -> 512 -> ... 순으로 높지만, loss 대비 정확도는 256이 제일 낫다.

<img src="img/compare_fvector_len_dnn.png"/>

---

## Result

---

## Reference

- 정성민, 김현석, 김영재 and 윤명근. "V-그램: 명령어 기본 블록과 딥러닝 기반의 악성코드 탐지" 정보과학회논문지 46, no.7 (2019) : 599-605.doi: https://doi.org/10.5626/JOK.2019.46.7.599

### Dataset

- 정상/악성파일 opcodes : 정보보호 R&D 데이터챌린지 2017(http://datachallenge.kr), 한국인터넷진흥원(KISA), https://drive.google.com/file/d/1to0x585_GdG_KtNCbNroNE_w-IEYZHOh/view?usp=sharing
